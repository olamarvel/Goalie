<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="index.css" />
        <link rel="shortcut icon" href="logo.png" type="image/x-icon" />

        <title>Match Settings</title>
    </head>
    <body class="bg-gray-100 p-2 flex flex-col gap-4">
        <nav
            class="bg-white shadow row-span-2 w-full max-w-screen-lg mx-auto rounded-lg"
        >
            <div class="mx-auto px-4 py-2 flex justify-between">
                <h1 class="text-xl font-bold">Match Settings</h1>
                <button
                    onclick="saveSettings()"
                    class="bg-blue-500 text-white px-4 py-2 rounded"
                >
                    Save Settings
                </button>
            </div>
        </nav>
        <div
            class="mx-auto p-4 max-w-screen-lg bg-white w-full rounded-lg shadow"
        >
            <h2 class="text-lg font-medium py-1 text-center w-full">
                Notification Settings
            </h2>
            <div>
                <label for="updateRate" class="block">Update Rate:</label>
                <select
                    id="updateRate"
                    class="mt-1 border-b rounded w-full h-8 px-2 py-1"
                >
                    <option value="5">Rarely (Every 5 mins)</option>
                    <option value="3">Often (Every 3 mins)</option>
                    <option value="1" selected>Frequently (Every 1 min)</option>
                    <option value="custom" disabled>Custom...</option>
                </select>
            </div>
            <div class="flex items-center mt-4">
                <label for="pauseSubscription" class="mr-6"
                    >Pause Subscription:</label
                >
                <input
                    type="checkbox"
                    id="pauseSubscription"
                    class="mt-1 w-6 h-6"
                />
            </div>
            <div id="notificationCenter">
                <label class="block mt-2">Notification Types:</label>
                <div class="flex items-center">
                    <input
                        type="radio"
                        name="notificationType"
                        id="showImportant"
                        class="mr-2"
                        onclick="toggleDiv(this)"
                        value="Show Important"
                    />
                    <label for="showImportant">Show Important</label>
                </div>
                <div class="flex items-center">
                    <input
                        type="radio"
                        name="notificationType"
                        id="showLess"
                        class="mr-2"
                        onclick="toggleDiv(this)"
                        value="Show Less"
                        checked
                    />
                    <label for="showLess">Show Less (Default)</label>
                </div>
                <div class="flex items-center">
                    <input
                        type="radio"
                        name="notificationType"
                        id="showAll"
                        class="mr-2"
                        onclick="toggleDiv(this)"
                        value="Show All"
                    />
                    <label for="showAll">Show All</label>
                </div>
                <div class="flex items-center">
                    <input
                        type="radio"
                        name="notificationType"
                        id="selectNotificationType"
                        onclick="toggleDiv(this)"
                        value="Select Notification Type"
                        class="mr-2"
                    />
                    <label for="selectNotificationType"
                        >Select Notification Type</label
                    >
                </div>
            </div>

            <div id="customNotificationType" class="mt-4 hidden">
                <label class="block">Custom Notification Type:</label>
                <div class="flex flex-wrap">
                    <div class="w-1/2 p-2">
                        <input
                            type="checkbox"
                            id="end14"
                            class="mr-2"
                            checked
                        />
                        <label for="end14">End 14</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input type="checkbox" id="end2" class="mr-2" checked />
                        <label for="end2">End 2</label>
                    </div>
                    <!-- Add more checkboxes as per the list -->
                    <!-- Example for more options -->
                    <div class="w-1/2 p-2">
                        <input type="checkbox" id="YC" class="mr-2" checked />
                        <label for="YC">YC</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input type="checkbox" id="miss" class="mr-2" checked />
                        <label for="miss">Miss</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input
                            type="checkbox"
                            id="corner"
                            class="mr-2"
                            checked
                        />
                        <label for="corner">Corner</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input type="checkbox" id="SI" class="mr-2" checked />
                        <label for="SI">SI</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input
                            type="checkbox"
                            id="addedTime"
                            class="mr-2"
                            checked
                        />
                        <label for="addedTime">Added Time</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input type="checkbox" id="Y2C" class="mr-2" checked />
                        <label for="Y2C">Y2C</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input type="checkbox" id="G" class="mr-2" checked />
                        <label for="G">G</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input
                            type="checkbox"
                            id="attemptSaved"
                            class="mr-2"
                            checked
                        />
                        <label for="attemptSaved">Attempt Saved</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input
                            type="checkbox"
                            id="start"
                            class="mr-2"
                            checked
                        />
                        <label for="start">Start</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input type="checkbox" id="end1" class="mr-2" checked />
                        <label for="end1">End 1</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input
                            type="checkbox"
                            id="offside"
                            class="mr-2"
                            checked
                        />
                        <label for="offside">Offside</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input type="checkbox" id="OG" class="mr-2" checked />
                        <label for="OG">OG</label>
                    </div>
                    <div class="w-1/2 p-2">
                        <input
                            type="checkbox"
                            id="lineup"
                            class="mr-2"
                            checked
                        />
                        <label for="lineup">Lineup</label>
                    </div>
                </div>
            </div>
        </div>

        <div
            class="mx-auto p-4 max-w-screen-lg bg-white w-full rounded-lg shadow"
        >
            <h2 class="text-lg font-medium py-1 text-center w-full">
                Highlights settings
            </h2>
            <div>
                <label class="block mt-4"
                    >Redirect to Highlights if Possible:</label
                >
                <div class="flex items-center">
                    <input
                        type="radio"
                        id="redirectToHighlights"
                        name="redirectToHighlights"
                        class="mr-2"
                    />
                    <label for="redirectToHighlights">True</label>
                </div>
                <div class="flex items-center">
                    <input
                        type="radio"
                        id="redirectToHighlights"
                        name="redirectToHighlights"
                        class="mr-2"
                        checked
                    />
                    <label for="redirectToHighlights">False (Default)</label>
                </div>
            </div>
        </div>

        <script>
            async function saveSettings() {
                const settings = {
                    updateRate: document.getElementById('updateRate').value,
                    pauseSubscription:
                        document.getElementById('pauseSubscription').checked,
                    notificationTypes: {
                        showImportant:
                            document.getElementById('showImportant').checked,
                        showLess: document.getElementById('showLess').checked,
                        showAll: document.getElementById('showAll').checked,
                        selectNotificationType: document.getElementById(
                            'selectNotificationType'
                        ).checked,
                        customNotificationType: Array.from(
                            document.querySelectorAll(
                                '#customNotificationType input:checked'
                            )
                        ).map(el => el.id),
                    },
                    redirectToHighlights: document.getElementById(
                        'redirectToHighlights'
                    ).checked,
                };

                const urlParams = new URLSearchParams(window.location.search);
                const matchId = urlParams.get('matchId');

                const response = await fetch(`/settings/${matchId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(settings),
                });

                const result = await response.text();
                alert(result);
            }

            async function loadSettings() {
                const urlParams = new URLSearchParams(window.location.search);
                const matchId = urlParams.get('matchId');

                const response = await fetch(`/settings/${matchId}`);
                const settings = await response.json();

                document.getElementById('updateRate').value =
                    settings?.updateRate;
                document.getElementById('pauseSubscription').checked =
                    settings?.pauseSubscription;
                document.getElementById('showImportant').checked =
                    settings?.notificationTypes?.showImportant;
                document.getElementById('showLess').checked =
                    settings?.notificationTypes?.showLess;
                document.getElementById('showAll').checked =
                    settings?.notificationTypes?.showAll;
                document.getElementById('selectNotificationType').checked =
                    settings?.notificationTypes?.selectNotificationType;
                document.getElementById('redirectToHighlights').checked =
                    settings?.redirectToHighlights;

                const customNotificationType =
                    settings?.notificationTypes?.customNotificationType;
                customNotificationType?.forEach(type => {
                    const ETYPE =
                    document.getElementById(type)
                    if(ETYPE)ETYPE.checked = true;
                });

                // document.getElementById("notificationCenter").addEventListener("click",(event) => {
                //     debugger
                //     if (document.getElementById('selectNotificationType').checked)
                //         document.getElementById('customNotificationType').classList.remove('hidden');
                //     else
                //         document.getElementById('customNotificationType').classList.add('hidden');
                // })
            }

            function toggleDiv(radio) {
                // classList.toggle('hidden', !settings.notificationTypes.selectNotificationType);
                const contentDiv = document.getElementById(
                    'customNotificationType'
                );
                if (radio.id === 'selectNotificationType') {
                    contentDiv.classList.remove('hidden');
                } else {
                    contentDiv.classList.add('hidden');
                }
            }
            loadSettings(); // Load settings on page load
        </script>
    </body>
</html>
